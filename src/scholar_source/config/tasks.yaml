course_analysis_task:
  description: >
    Analyze the course URL and provided information to identify the EXACT academic discipline
    and specific topics covered. This is CRITICAL - you must correctly identify the field to
    prevent recommending off-topic resources.

    **Input Sources (use whatever is available):**
    - Course information: course_url (MOST IMPORTANT - use WebsiteSearchTool to analyze)
    - Book information: book_title, book_author, isbn, book_url
    - User-provided topics: topics_list
    - Additional context: textbook

    **CRITICAL VALIDATION - DO THIS FIRST:**
    Before proceeding, validate that you can access at least one primary source:
    - If course_url is provided, attempt to access it with WebsiteSearchTool. If you CANNOT access it, STOP and return an error.
    - If book_url is provided, attempt to access it. If you CANNOT access it, STOP and return an error.
    - If ONLY book_title/author/isbn/topics_list are provided, skip validation (these don't require access checks)
    - If NONE of the above sources are provided or accessible, STOP and return an error.

    **ERROR FORMAT:** If you cannot access any primary sources, return: "ERROR: Cannot access provided resources. [specific details about what failed]"

    **STEP 1: Find the Textbook and Syllabus on Course Page**
    If course_url is provided and accessible, use WebsiteSearchTool to:
    1. **Find the textbook** - Search for:
       - "Textbook", "Required Text", "Required Reading", "Course Materials", "Required Textbooks"
       - Extract the EXACT textbook title, author, edition, ISBN if mentioned
       - DO NOT make assumptions - only extract what's explicitly listed

    2. **Find the syllabus** - Search for:
       - "Syllabus", "Course Outline", "Schedule", "Weekly Topics"
       - Extract syllabus URL if available as a link
       - If syllabus content is on the page, extract the weekly topics/schedule

    **STEP 2: Get Topics from the Textbook's Table of Contents**
    1. **If textbook title was found on course page:**
       - Search web for "[textbook title] [author] table of contents"
       - Try to extract ALL chapter titles and section headings from the textbook's ToC
       - If you CANNOT find the table of contents online, note this in your output

    2. **If textbook title was provided by user (book_title/book_author):**
       - Search web for the textbook's table of contents the same way
       - If you CANNOT find it, note this in your output

    **STEP 3: Extract Topics from Course Page or User Input**
    1. Extract any topic list from the course description if present
    2. Extract topics from syllabus if found
    3. **If user provided topics_list, use that as the PRIMARY source**

    **STEP 4: CRITICAL - Verify You Have Topics**
    - If you have ZERO topics from ALL sources (no textbook ToC, no syllabus, no course topics, no user topics_list):
      * STOP and return: "ERROR: Cannot determine course topics. Please provide either: (1) a PDF of the textbook, OR (2) a list of topics covered in the course."
    - If you found the textbook title but CANNOT find its table of contents online:
      * STOP and return: "ERROR: Found textbook [title] but cannot access its table of contents. Please provide either: (1) a PDF of the textbook, OR (2) a list of topics covered in the course."

    **STEP 5: Compile Topics (only if you have topics)**
    - Combine ALL topics from available sources
    - List 5-15 specific topics
    - Extract course title and course number from the page
    
    Available input variables (all optional):
    university_name, course_name, course_url, textbook, topics_list,
    book_title, book_author, isbn, book_pdf_path, book_url

    The following inputs were provided:
    {university_name}
    {course_name}
    {course_url}
    {textbook}
    {topics_list}
    {book_title}
    {book_author}
    {isbn}
    {book_pdf_path}
    {book_url}

    Note: Not all input variables will be populated. Use whatever is available to extract
    the book's structure and topics.
  expected_output: >
    A structured analysis containing:

    - course_title: The course name from the course page (e.g., "Engineering Analysis: Statics")
    - course_number: The course number (e.g., "GEN_ENG 205-2")
    - official_textbooks: Textbook title, author, edition, ISBN if found on course page
    - syllabus_url: URL to syllabus if found on course page
    - topics: Comprehensive list of ALL topics from textbook ToC, syllabus, course page, or user input
      (e.g., ["Vectors", "Forces", "Systems of Forces and Moments", "Equilibrium", "Structures",
      "Centroids", "Centers of Mass", "Moments of Inertia", "Friction", "Internal Forces", "Virtual Work"])
    - course_level: "introductory" | "intermediate" | "advanced" | "professional"
    - textbook_source: Where textbook info came from ("course_page", "user_provided", "not_found")
    - subject_keywords: List of keywords describing the subject based on topics (e.g., ["statics", "mechanics", "forces", "equilibrium"])

    Format as a clean JSON object or structured text that subsequent agents can easily parse.
  agent: course_intelligence_agent

resource_search_task:
  description: >
    Based on the topics and subject_keywords from the course analysis, search for 5-7 high-quality
    resources from USA-based institutions that cover the same topics as the textbook.

    **CRITICAL TOPIC MATCHING:**
    - Read the topics list from the course analysis (e.g., ["Vectors", "Forces", "Equilibrium", "Centroids", "Moments of Inertia"])
    - Read the subject_keywords (e.g., ["statics", "mechanics", "forces"])
    - Search for resources that cover THESE SPECIFIC TOPICS
    - Use the subject_keywords in your search terms to find relevant resources
    - Verify that each resource actually covers the topics from the list

    **CRITICAL RESTRICTION:** ONLY include resources from United States universities,
    institutions, and educational platforms. Do NOT include resources from universities
    or institutions outside the USA.

    **Priority Resource Types (in order):**
    1. Practice problems with answer keys (problem sets, practice exams, solved exercises from reputable US universities)
    2. Open textbooks (OpenStax, LibreTexts, etc.) covering the same topics
    3. US University course materials (MIT OCW, Stanford, Berkeley, etc.) - PDFs and web pages
    4. US Educational platform content (Khan Academy, Coursera, edX) - text-based materials
    5. Peer-reviewed open access papers from US institutions for advanced topics

    **HOW TO USE YOUR SEARCH TOOL:**
    You have access to the "Search the internet with Serper" tool. To use it:
    1. Call the tool with a simple search query string as the search_query parameter
    2. Example: search_query="statics practice problems with solutions MIT"
    3. DO NOT pass complex objects - only pass a simple string
    4. The tool will return search results that you can analyze

    **Search Strategy:**
    - Use the subject_keywords from the analysis in your searches
    - Combine keywords with topics to create search queries
    - Example for topics ["Forces", "Equilibrium", "Moments"] with keywords ["statics", "mechanics"]:
      * Use tool with search_query="statics practice problems with solutions"
      * Use tool with search_query="mechanics equilibrium MIT OpenCourseWare"
      * Use tool with search_query="statics moments of inertia problem sets"
    - Perform 5-7 targeted searches to find high-quality resources
    - Aim for 5-7 total resources - quality over quantity
    - **ONLY search for and include USA-based sources**
    - Match the course level (don't suggest PhD-level for intro courses)

    **Quality Criteria:**
    - Must be legally free and publicly accessible (no pirated content)
    - **Must be from United States sources ONLY** (US universities, US institutions, US platforms)
    - Must be from reputable sources (universities, established ed platforms)
    - Should align with the book's table of contents structure
    - Must be compatible with NotebookLM (PDF, web page, or YouTube URL)
    - Prioritize text-based content (PDFs, web pages) that NotebookLM can easily process and extract information from
    - YouTube videos should only be included when they provide unique value not available in text format

    **Example Search Queries to Try:**
    Use your search tool with queries like these (substitute with actual topics from the course):
    - "[book topic] university course materials"
    - "[book topic] university homework solutions pdf"
    - "[book topic] practice problems with solutions pdf"
    - "[book topic] problem set with answer key"
    - "[book topic] practice exam with solutions"
    - "[book topic] MIT OpenCourseWare problem set solutions"
    - "[book topic] AP practice test with answers" (for high school courses)
    - "[book title] open textbook pdf"
    - "[book topic] open textbook pdf"
    - "[book topic] MIT OpenCourseWare PDF"
    - "[book topic] open access textbook"
    - "[book topic] course notes pdf"
    - "[book topic] lecture notes"
    - "[book topic] lecture video YouTube" (only if text alternatives are limited)
    
    Focus on finding resources that students can add to NotebookLM alongside their book
    to create comprehensive study materials (flashcards, quizzes, etc.).

    Use the output from the course_analysis_task to guide your search.
  expected_output: >
    A curated list of 5-7 recommended resources that complement the student's book, each containing:
    
    - resource_title: Full title of the resource
    - resource_type: "open_textbook" | "video_lecture" | "lecture_series" | 
      "interactive_tutorial" | "course_notes" | "educational_video"
    - url: Direct link to the resource (must be accessible without login)
    - coverage_topics: List of book topics/chapters this resource addresses
    - source_credibility: Origin (e.g., "MIT OpenCourseWare", "OpenStax", "Khan Academy")
    - content_scope: "comprehensive" | "supplementary" | "topic-specific"
    - access_notes: Confirmation that it's free, legal, and openly accessible
    - estimated_depth: "introductory" | "intermediate" | "advanced"
    - alignment_with_book: Brief note on how this resource aligns with the book's structure

    Organize resources clearly. Include brief reasoning for why each resource was selected
    and how it complements the student's book.
  agent: resource_discovery_agent

resource_validation_task:
  description: >
    Validate each resource discovered by the resource_discovery_agent to ensure it
    meets quality, legal, and technical requirements. For each resource:
    
    **Accessibility Checks:**
    1. Verify the URL is functional and publicly accessible (no 404s, no paywalls)
    2. Confirm no login or payment is required
    3. Check that the content actually loads (use web_fetch if needed for URLs)
    
    **NotebookLM Compatibility Checks:**
    1. Verify format compatibility:
       - PDFs: Must be direct PDF links (not HTML pages about PDFs)
       - YouTube: Must be standard youtube.com or youtu.be URLs
       - Web pages: Must be publicly accessible HTML pages
    2. Check file size if PDF (NotebookLM has limits, typically under 500MB)
    
    **Legal and Copyright Checks:**
    1. Look for clear licensing information (Creative Commons, Open Access, etc.)
    2. Verify the source is reputable and authorized to distribute
    3. Flag any resources that appear to be pirated or unauthorized copies
    4. Ensure it's not behind academic journal paywalls
    
    **Quality Checks:**
    1. Assess content relevance to the course topics
    2. Evaluate source credibility and academic rigor
    3. Check for comprehensiveness (not just snippets or summaries)
    4. Verify alignment with stated course level
    
    **Filtering Criteria - REMOVE resources that:**
    - Require login, subscription, or payment
    - Are pirated or copyright-infringing materials
    - Have broken or inaccessible links
    - Are low quality, incomplete, or off-topic
    - Are not NotebookLM compatible
    - Lack clear legal authorization for public access
    
    Score each approved resource on usefulness (1-10) based on:
    - Relevance to course topics (40%)
    - Comprehensiveness of coverage (30%)
    - Source credibility (20%)
    - User-friendliness (10%)

    Use the resources discovered by the previous task as your input.
  expected_output: >
    A filtered and validated list of resources, each containing:
    
    - All original resource fields from the search task
    - validation_status: "approved" | "rejected"
    - rejection_reason: Detailed explanation if rejected
    - notebooklm_compatible: true | false
    - notebooklm_format: "pdf" | "youtube" | "webpage" | "not_compatible"
    - license_info: Copyright/license information found
    - accessibility_verified: true | false
    - usefulness_score: 1-10 (integer)
    - validation_notes: Any important notes about the resource
    
    **Summary Statistics:**
    - Total resources validated: X
    - Approved: X
    - Rejected: X
    - Average usefulness score: X.X
    
    Only include APPROVED resources in the final list. Aim for 5-7 high-quality 
    approved resources total. If fewer than 5 pass validation, note this in the output.
  agent: resource_validator_agent

final_output_task:
  description: >
    Create a student-friendly, actionable resource guide that students can
    immediately use to enhance their learning with Google NotebookLM.

    **Guide Structure:**

    1. **Textbook Information Section:**
       - Display the official textbook title and author(s) if available
       - Show where this information was found (course page, user-provided, etc.)
       - This helps students confirm the resources match their course textbook

    2. **Course Overview Section:**
       - Brief description of the course/book
       - Key topics that will be covered
       - Learning objectives or skills to develop

    3. **Recommended Resources Section:**
       - Organize resources by topic area or resource type (choose most logical)
       - For each resource include:
         * Clear title and resource type
         * Direct clickable URL
         * Brief description (2-3 sentences) of what it covers and why it's useful
         * Which specific topics it addresses
         * Estimated time/scope (e.g., "Full textbook", "5-part video series", "Single lecture")

    4. **How to Add to NotebookLM Section:**
       - Step-by-step instructions for adding each type of resource
       - Tips for organizing sources within NotebookLM
       - Suggestions for how to use multiple sources effectively

    5. **Study Tips Section:**
       - How to leverage NotebookLM's features with these sources
       - Suggested study workflow (e.g., create flashcards, generate practice questions)
       - Tips for getting the most value from multiple perspectives
    
    **Formatting Guidelines:**
    - Use clear headers and subheaders
    - Keep descriptions concise but informative
    - Make URLs easily clickable
    - Use bullet points and numbered lists for readability
    - Add emoji or visual markers sparingly for key sections
    - Keep total guide length to 2-4 pages when printed
    
    **Tone:**
    - Encouraging and supportive
    - Clear and jargon-free
    - Action-oriented (tell students exactly what to do)
    - Assume student may not be tech-savvy

    Use the validated resources and course analysis from previous tasks to create
    a comprehensive student-friendly guide.
  expected_output: >
    A formatted markdown document ready to present to the student:
    
    # Study Resources for [Course Name]
    
    ## üìö Course Overview
    [2-3 sentence description of what this course covers and what students will learn]
    
    **Key Topics:**
    - Topic 1
    - Topic 2
    - Topic 3
    [etc.]
    
    ---
    
    ## üéØ Recommended Resources
    
    I've found [X] high-quality, free resources to supplement your learning:
    
    ### [Topic Area 1] or [Resource Type 1]
    
    **1. [Resource Title]** (Type: Textbook/Video/etc.)
    - **Link:** [Direct URL]
    - **What it covers:** [Brief description highlighting value]
    - **Best for:** [When/how to use this resource]
    - **Usefulness Score:** ‚≠êÔ∏è [X/10]
    
    **2. [Next resource]**
    [Same format]
    
    ### [Topic Area 2] or [Resource Type 2]
    [Continue...]
    
    ---
    
    ## üì• How to Add These to NotebookLM
    
    **For PDFs:**
    1. Click the link to open the PDF
    2. In NotebookLM, click "+ New Source"
    3. Select "Upload" and choose the PDF file
    
    **For YouTube Videos:**
    1. Copy the YouTube URL
    2. In NotebookLM, click "+ New Source"
    3. Select "YouTube URL" and paste the link
    
    **For Web Pages:**
    1. Copy the webpage URL
    2. In NotebookLM, click "+ New Source"
    3. Select "Website URL" and paste the link
    
    ---
    
    ## üí° Study Tips
    
    **Using Multiple Sources:**
    - [Tip 1]
    - [Tip 2]
    - [Tip 3]
    
    **Maximizing NotebookLM:**
    - Use the chat feature to ask questions across all sources
    - Generate study guides from multiple perspectives
    - Create flashcards from the combined knowledge base
    - Use the audio overview feature to hear key concepts explained
    
    ---
    
    **Total Resources:** [X] carefully vetted, free, and legal educational materials
    
    **Need More Help?** [Optional: suggestions for finding additional resources]
    
    ---
    
    *All resources are freely and legally accessible. No pirated content included.*
  agent: output_formatter_agent